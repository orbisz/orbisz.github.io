import{_ as l,c as i,a as o,o as c}from"./app-ByLG9LQz.js";const d={};function a(n,e){return c(),i("div",null,e[0]||(e[0]=[o(`<p>本项目实现了一个多模型AI服务统一接入SDK，通过良好的架构设计，使得开发者可以使用统一的API调用不同的AI模型，大大简化了集成多个AI服务的复杂度。 项目支持文本对话、图片生成、图片理解等多种功能，采用流式输出和异步处理提升用户体验。</p><p>这是一个统一的AI模型SDK，用于集成多个主流AI服务提供商的API，包括：</p><ul><li>OpenAI ChatGPT</li><li>阿里通义千问</li><li>百度文心一言</li><li>智谱ChatGLM</li><li>腾讯混元</li><li>讯飞星火</li><li>Google PaLM2/Gemini Pro</li><li>360智脑</li><li>Claude (待实现)</li></ul><h2 id="核心架构" tabindex="-1"><a class="header-anchor" href="#核心架构"><span>核心架构</span></a></h2><p>项目采用了分层架构和策略模式的设计：</p><ol><li><p><code>Session</code>层</p><ul><li><code>OpenAiSession</code>: 统一会话接口，提供所有AI交互的API</li><li><code>OpenAiSessionFactory</code>: 工厂接口，用于创建会话</li><li><code>Configuration</code>: 中央配置类，管理所有AI模型的配置</li><li><code>DefaultOpenAiSession</code>: 默认会话实现</li><li><code>DefaultOpenAiSessionFactory</code>: 工厂实现，负责创建和配置会话</li></ul></li><li><p><code>Executor</code>层</p><ul><li><code>Executor</code>: 执行器接口，定义所有AI模型的统一操作，每个AI模型都有独立的执行器实现（如ChatGPTModelExecutor）</li><li><code>interceptor</code>：HTTP 传输层的横切拦截器 <ul><li>作用:为所有请求统一设置基础头（<code>Content-Type</code>、<code>User-Agent</code>、<code>Accept</code>），保证 SSE 与 JSON 请求的协议一致性。</li><li>实现:<code>HTTPInterceptor</code>注入到<code>OkHttpClient</code>，在会话工厂初始化时安装</li><li>关系:与认证无直接耦合；各模型的认证头在对应<code>model/*Executor</code>内部单独设置（如<code>Authorization: Bearer</code>）</li></ul></li><li><code>parameter</code>：统一的跨模型请求/响应 DTO 与参数转换接口 <ul><li>作用：为统一会话 API 提供通用数据模型，降低各厂商请求结构差异 <ul><li>文本对话：<code>CompletionRequest</code>、<code>Message</code>、<code>CompletionResponse</code>、<code>ChatChoice</code>、<code>Usage</code></li><li>图片：<code>ImageRequest</code>、<code>ImageEditRequest</code>、<code>ImageResponse</code>；图片理解：<code>PictureRequest</code>、<code>PictureContentEnum</code></li></ul></li></ul></li><li>result ：SSE 等流式事件处理的统一抽象 <ul><li>作用：对流式事件（SSE）的监听处理进行统一抽象，便于在各执行器中复用/适配</li><li>接口：<code>ResultHandler</code>仅定义监听器透传/包装方法，具体处理可在执行器中实现或复用</li><li>关系：结合会话实现的同步聚合逻辑，将流式事件汇总为<code>CompletableFuture&lt;String&gt;</code>（会话层处理；与<code>result</code>包协作）</li></ul></li><li><code>model</code>：各模型厂商的具体执行器与其私有 VO/配置/工具 <ul><li>作用：承载“厂商/模型”的具体执行逻辑，实现统一的<code>Executor</code>接口；内部完成： <ul><li>认证：Bearer/JWT/HMAC/TC3等签名与令牌获取</li><li>传输：SSE、同步 HTTP、WebSocket 的请求构建与响应解析</li><li>DTO：各厂商私有的请求/响应 VO</li></ul></li></ul></li></ul><blockquote><ul><li><code>OpenAiSession</code>作为统一入口，按<code>CompletionRequest.model</code>路由到<code>model/*Executor</code></li><li><code>interceptor</code>提供通用 HTTP 头；<code>model/*Executor</code>负责具体认证与协议细节</li><li><code>parameter</code>保证会话 API 的跨模型一致性，并通过<code>ParameterHandler</code>做私有参数适配</li><li><code>result</code>统一事件监听抽象，结合会话层实现同步结果聚合</li></ul></blockquote></li><li><p>模型层 (<code>executor.model.*</code>)</p></li></ol><p>每个AI模型都有自己的包结构：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">model/</span>
<span class="line">├── chatgpt/          # OpenAI ChatGPT</span>
<span class="line">├── aliyun/           # 阿里通义千问</span>
<span class="line">├── baidu/            # 百度文心一言</span>
<span class="line">├── chatglm/          # 智谱ChatGLM</span>
<span class="line">├── tencent/          # 腾讯混元</span>
<span class="line">├── xunfei/           # 讯飞星火</span>
<span class="line">├── google/           # Google PaLM/Gemini</span>
<span class="line">├── brain360/         # 360智脑</span>
<span class="line">├── gemini/           # Gemini Pro</span>
<span class="line">└── claude/           # Claude</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每个模型包包含：</p><ul><li><code>ModelExecutor.java</code>: 执行器实现</li><li><code>config/Config.java</code>: 模型配置</li><li><code>valobj/</code>: 请求响应对象</li></ul><ol start="4"><li>参数层 (<code>executor.parameter</code>)</li></ol><ul><li><code>CompletionRequest</code>: 统一的对话请求对象</li><li><code>CompletionResponse</code>: 统一的响应对象</li><li><code>Message</code>: 标准化的消息格式</li><li><code>ImageRequest/ImageResponse</code>: 图片生成相关</li><li>其他通用参数类</li></ul><h2 id="核心功能" tabindex="-1"><a class="header-anchor" href="#核心功能"><span>核心功能</span></a></h2><ol><li>文本对话功能 <ul><li>支持流式输出（<code>Server-Sent Events</code>）</li><li>支持同步响应</li><li>可配置温度、top_p、最大token数等参数</li></ul></li><li>图片生成功能 <ul><li>支持DALL-E 2/3图片生成</li><li>支持图片编辑（ChatGPT）</li><li>支持文生图（百度文心）</li></ul></li><li>图片理解功能 <ul><li>支持图片内容理解和描述</li></ul></li><li>统一配置管理 <ul><li>每个模型独立的配置类</li><li>支持自定义API密钥和主机</li><li>HTTP客户端统一配置</li></ul></li></ol><h2 id="设计模式" tabindex="-1"><a class="header-anchor" href="#设计模式"><span>设计模式</span></a></h2><ol><li>工厂模式: <code>OpenAiSessionFactory</code>创建会话</li><li>策略模式: 不同模型执行器实现相同接口</li><li>建造者模式: 请求对象使用<code>Builder</code>构建</li><li>拦截器模式: HTTP请求统一处理</li><li>适配器模式: 不同AI模型API适配为统一接口</li></ol><h2 id="典型调用链" tabindex="-1"><a class="header-anchor" href="#典型调用链"><span>典型调用链</span></a></h2><ul><li>问答（流式）：<code>OpenAiSession.completions</code>→ 查找执行器并转发 → 执行器构建请求（认证、JSON）→ <code>EventSource</code>推送 → 业务监听或会话实现聚合 OpenAiSession.java:26 → DefaultOpenAiSession.java:31-36 → ChatGPTModelExecutor.java:52-74</li><li>问答（同步）：在会话层以监听器收集 SSE 片段并完成<code>CompletableFuture DefaultOpenAiSession.java:53-96</code></li><li>图片生成/编辑：<code>OpenAiSession.genImages/editImages</code>→ 执行器同步 HTTP 调用（JSON 或 multipart）→ 解析响应<code>DefaultOpenAiSession.java:98-108,130-138</code>→<code>ChatGPTModelExecutor.java:82-115,124-167</code></li></ul><h3 id="通义千问执行器认证与请求构建过程举例" tabindex="-1"><a class="header-anchor" href="#通义千问执行器认证与请求构建过程举例"><span>通义千问执行器认证与请求构建过程举例</span></a></h3><ul><li>通义千问执行器以 SSE 流式为主，使用<code>Authorization: Bearer &lt;apiKey&gt;</code>完成认证，目标端点为<code>DashScope</code>文本生成 API。</li><li>将通用<code>CompletionRequest</code>转换为 Ali 专属<code>AliModelCompletionRequest</code>，设置相关参数配置，并在事件监听中将 Ali 响应统一适配为通用<code>CompletionResponse</code>。</li></ul>`,20)]))}const t=l(d,[["render",a]]),r=JSON.parse('{"path":"/blogs/Project/one-api-sdk/one-api-sdk.html","title":"统一大模型对接SDK实现","lang":"en-US","frontmatter":{"title":"统一大模型对接SDK实现","date":"2025/12/18","tags":["AI","组件开发","LLM"],"categories":["后端开发"]},"headers":[{"level":2,"title":"核心架构","slug":"核心架构","link":"#核心架构","children":[]},{"level":2,"title":"核心功能","slug":"核心功能","link":"#核心功能","children":[]},{"level":2,"title":"设计模式","slug":"设计模式","link":"#设计模式","children":[]},{"level":2,"title":"典型调用链","slug":"典型调用链","link":"#典型调用链","children":[{"level":3,"title":"通义千问执行器认证与请求构建过程举例","slug":"通义千问执行器认证与请求构建过程举例","link":"#通义千问执行器认证与请求构建过程举例","children":[]}]}],"git":{"createdTime":1766914010000,"updatedTime":1766914010000,"contributors":[{"name":"orbisz","email":"zxy0613zxy@outlook.com","commits":1}]},"filePathRelative":"blogs/Project/one-api-sdk/one-api-sdk.md"}');export{t as comp,r as data};
